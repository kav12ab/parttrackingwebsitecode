<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Rack Data Dashboard</title>
  <!-- Firebase App (the core Firebase SDK) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <!-- Firebase Realtime Database -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <style>
    table, th, td {
      border: 1px solid #333;
      border-collapse: collapse;
      padding: 8px;
      text-align: center;
    }
    table {
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
  <h1>Rack Data Dashboard</h1>
  <div>
    <label for="rackSelect">Select Rack ID:</label>
    <select id="rackSelect">
      <option value="1110001">1110001</option>
      <option value="1110002">1110002</option>
    </select>
    <button id="loadData">Load Data</button>
  </div>
  <hr>
  <h2>Received Data</h2>
  <table id="receivedTable">
    <thead>
      <tr>
        <th>Sensor ID</th>
        <th>Auto Mode</th>
        <th>Auto Box Size</th>
        <th>Box Count</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <hr>
  <h2>Stored Data</h2>
  <table id="storedTable">
    <thead>
      <tr>
        <th>Sensor ID</th>
        <th>Box Size</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <div id="rackLengthDisplay"></div>
  <script>
    // TODO: Replace with your Firebase project's configuration
    const firebaseConfig = {
              	apiKey: "AIzaSyDHJoBc4yZqGIWcaW-cqwBYh_9IWW9f3Bc",
                authDomain: "logistics-parts-tracking.firebaseapp.com",
                databaseURL: "https://logistics-parts-tracking-default-rtdb.europe-west1.firebasedatabase.app",
                projectId: "logistics-parts-tracking",
                storageBucket: "logistics-parts-tracking.firebasestorage.app",
                messagingSenderId: "160509055364",
                appId: "1:160509055364:web:28849f90fdd3d2420d8dd1",
      appId: "YOUR_APP_ID"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    document.getElementById('loadData').addEventListener('click', function() {
      const rackId = document.getElementById('rackSelect').value;
      loadReceivedData(rackId);
      loadStoredData(rackId);
    });

    function loadReceivedData(rackId) {
      const receivedRef = database.ref('ReceivedData/' + rackId);
      receivedRef.once('value').then(function(snapshot) {
        const tbody = document.getElementById('receivedTable').getElementsByTagName('tbody')[0];
        tbody.innerHTML = ""; // clear previous data
        snapshot.forEach(function(childSnapshot) {
          const sensorData = childSnapshot.val();
          const row = tbody.insertRow();
          row.insertCell().innerText = sensorData.sensorID || "N/A";
          row.insertCell().innerText = sensorData.autoMode ? "true" : "false";
          row.insertCell().innerText = sensorData.autoBoxSize || "N/A";
          row.insertCell().innerText = sensorData.boxCount || "N/A";
        });
      });
    }

    function loadStoredData(rackId) {
      const storedRef = database.ref('StoredData/' + rackId);
      storedRef.once('value').then(function(snapshot) {
        const data = snapshot.val();
        const storedTbody = document.getElementById('storedTable').getElementsByTagName('tbody')[0];
        storedTbody.innerHTML = ""; // clear previous data

        // Display rackLength from /StoredData/<rackId>/rackLength
        const rackLengthDisplay = document.getElementById('rackLengthDisplay');
        if (data && data.rackLength) {
          rackLengthDisplay.innerHTML = "<strong>Rack Length:</strong> " + data.rackLength;
        } else {
          rackLengthDisplay.innerHTML = "<strong>Rack Length:</strong> N/A";
        }

        // Now get sensor data from /StoredData/<rackId>/sensors
        if (data && data.sensors) {
          Object.keys(data.sensors).forEach(function(sensorId) {
            const sensor = data.sensors[sensorId];
            const row = storedTbody.insertRow();
            row.insertCell().innerText = sensor.sensorID || sensorId;
            row.insertCell().innerText = sensor.boxSize || "N/A";
          });
        }
      });
    }
  </script>
</body>
</html>
